<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>共円｜ステージ一覧</title>
	<link type="text/css" rel="stylesheet" href="/css/base.css" />
	<link type="text/css" rel="stylesheet" href="/css/style.css" />
	<link type="text/css" rel="stylesheet" href="/css/list.css" />
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="/js/excanvas.js"></script>
	<![endif]-->
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="/js/jquery.color.js"></script>
	<script src="/js/list.js"></script>
	<script src="/js/overlay.js"></script>
	<script src="/js/pager.js"></script>
<script type="text/javascript">
function loadStage(stageNo, open) {
	$('#stages').html('Loading...');
	$.ajax({
		type: "POST",
		url: "/page/list",
		cache: false,
		dataType: "json",
		data: "index=" + stageNo,
		success: function(result) {
			var $stages = $('#stages').html('');
			var $ul = $('<ul />');
			$ul.appendTo($stages);
			for (var i = 0; i < result.length; i++) {
				var $li = $('<li />');
				$li.addClass('overlayKyouen');
				$li.appendTo($ul);
				var $stageno = $('<div />')
						.text('STAGE:' + result[i].stageNo)
						.addClass('stageno');
				$stageno.appendTo($li);
				var $creator = $('<div />')
						.addClass('creator')
						.text('created by ');
				$('<b />').text(result[i].creator)
						.appendTo($creator);
				$creator.appendTo($li);
				var $canvas = $('<canvas />').attr({
					id: 'canvas' + result[i].stageNo,
					width: '252',
					height: '252',
					'data-stageno': result[i].stageNo,
					'data-stage': result[i].stage,
					'data-size': result[i].size,
					'data-creator': result[i].creator,
					'data-clear': result[i].clear
				}).addClass('kyouenView');
				$canvas.appendTo($li);
			}
			$("canvas.kyouenView").kyouenView();
			$(".overlayKyouen").overlayKyouen();
			if (open) {
				$('#canvas' + open).parent().click()
			}
		}
	});
}

// 初期読み込み
$(function() {
	loadStage({{ summary.index }}, {{ summary.open }});
});
</script>
<!-- google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-15989719-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
<!-- twitter follow badge by go2web20 -->
<script src='http://www.go2web20.net/twitterfollowbadge/1.0/badge.js' type='text/javascript'></script><script type='text/javascript' charset='utf-8'><!--
tfb.account = 'noboru_i';
tfb.label = 'follow-me';
tfb.color = '#959595';
tfb.side = 'l';
tfb.top = 136;
tfb.showbadge();
--></script>
<!-- end of twitter follow badge -->
<div id="wrapper">
	<!-- ヘッダ -->
	<header>
		<div id="login">
{% if user %}
			<img src="{{ user.image }}"
				width="25"
				height="25">
			{{ user.screenName }}&nbsp;|&nbsp;
			<a href="/page/logout">ログアウト</a>
{% else %}
			<a href="/page/login">Twitterでログイン</a>
{% endif %}
		</div>
		<h1><a href="/">共円</a>｜ステージ一覧</h1>
		<nav id="menu">
			<ul>
			<li><a href="/">トップ</a></li>
			<li><a href="/page/application.html">アプリ紹介</a></li>
			<li><a href="/page/list.html">ステージ一覧</a></li>
			<li><a href="/page/summary.html">登録データサマリ</a></li>
			</ul>
		</nav>
	</header>

	<div id="summary">
		登録件数:{{ summary.count }}
	</div>
	<div class="pager clearfix"
			data-size="{{ summary.count }}"
			data-index="{{ summary.index }}">
	</div>
	<div id="stages">
	</div>
	<div class="pager clearfix"
			data-size="{{ summary.count }}"
			data-index="{{ summary.index }}">
	</div>

	<!-- フッタ -->
	<footer>
		<div id="copy">Copyright 2011 noboru All Rights Reserved.</div>
	</footer>

	<!-- オーバレイ -->
	<div id="kyouenView" style="position: initial; margin-top: 5px; margin-left: auto; margin-right: auto; display: none;">
		<div id="stageno0"></div>
		<div id="creator0"></div>
		<canvas id="canvas0"></canvas>
		<input id="kyouenButton" type="button" value="共円！！" />
	</div>

{% if not user %}
	<!-- 通知領域 -->
	<div id="notification">
		ログインすることで<br>クリア履歴を保存出来ます<br>
		→<a href="/page/login">Twitterでログイン</a>
	</div>
{% endif %}
</div>
</body>
</html>